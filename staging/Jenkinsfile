String gitCredentials = "MyGitHub"
String repoUrl = "https://github.com/warhunt/hello-app.git"
String ciRepoUrl = "https://github.com/warhunt/hello-app-ci.git"
String branchName = "staging"
pipeline {
    agent any 
    options {
        skipDefaultCheckout(true)
    }
    stages {
        stage('Build') { 
            steps {
                echo 'Cloning files from (branch: "' + branchName + '" )'
                git branch: branchName, credentialsId: gitCredentials, url: repoUrl

                dir('ci') {
                    echo 'Cloning files from ci'
                    git branch: 'master', credentialsId: gitCredentials, url: ciRepoUrl

                    fileOperations([fileCopyOperation(
                        excludes: 'staging/Jenkinsfile',
                        flattenFiles: true,
                        includes: "staging/*",
                        targetLocation: "${WORKSPACE}/"
                    )])
                }
                
                script {
                    dockerImage = docker.build "${DOCKER_IMAGE_NAME}"
                }
                
            }

        }
        //stage('Remove Unused docker image') {
        //    steps{
        //    sh "docker rmi $DOCKER_IMAGE_NAME:$BUILD_NUMBER"
        //    sh "docker rmi $DOCKER_IMAGE_NAME:latest"
        //    }
        //}
    }
}